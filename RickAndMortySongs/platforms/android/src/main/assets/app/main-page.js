/*global require, exports, android*/
var app = require('application');
var palette = require('./utilities/palette');
var platformModule = require('platform');
var color = require('color');
var Observable = require('data/observable');
var _MediaPlayer = require('./utilities/mediaPlayer');
var view = require('ui/core/view');
var imageSource = require('image-source');
var Color = color.Color;
var viewModel = new Observable.Observable({});
var context = app.android.context;
var mediaPlayer;
var coverImg;
var loaded = false;
function pageLoaded(args) {
    if (!loaded) {
        var page = args.object;
        loaded = true;
        page.bindingContext = viewModel;
        var path = 'assets/mp3/';
        coverImg = view.getViewById(page, 'coverImg');
        mediaPlayer = new _MediaPlayer.MediaPlayer();
        mediaPlayer.addToPlaylist({ img: '~/assets/images/season.jpg', path: path + 'rickandmortytheme.mp3', name: "Rick and Morty Intro" });
        mediaPlayer.addToPlaylist({ img: '~/assets/images/app.jpg', path: path + 'RaM205.HeadBentOver.FullSong.mp3', name: "Head Bent Over" });
        mediaPlayer.addToPlaylist({ img: '~/assets/images/fart.jpg', path: path + 'RickandMorty.GoodbyeMoonmen.FullSong.mp3', name: 'Good Bye Moonmen' });
        mediaPlayer.addToPlaylist({ img: '~/assets/images/ricknmorty.jpg', path: path + 'RaM205.GetSchwifty.FullSong.mp3', name: 'Get Schwifty' });
        var currentMp3 = mediaPlayer.getCurrentMp3();
        viewModel.set("song", currentMp3);
        coverImg.imageSource = imageSource.fromFile(currentMp3.img);
        picLoaded(coverImg);
        mediaPlayer.play();
    }
}
exports.pageLoaded = pageLoaded;
function tapEvent() {
    mediaPlayer.pause();
    mediaPlayer.reset();
    mediaPlayer.currentIndex += 1;
    mediaPlayer.loadMp3(mediaPlayer.currentIndex);
    // clean up after playback complete
    var currentMp3 = mediaPlayer.getCurrentMp3();
    viewModel.set("song", currentMp3);
    coverImg.imageSource = imageSource.fromFile(currentMp3.img);
    picLoaded(coverImg);
    mediaPlayer.play();
}
exports.tapEvent = tapEvent;
function picLoaded(arg) {
    if (arg != null) {
        var imgPalette = palette.MaterialPalette(arg);
        viewModel.set("vibrant", { color: new Color(imgPalette.vibrantRgb), textColor: imgPalette.vibrantBodyText });
        viewModel.set("darkVibrant", { color: new Color(imgPalette.darkVibrantRgb), textColor: imgPalette.darkVibrantBodyText });
        viewModel.set("lightVibrant", { color: new Color(imgPalette.lightVibrantRgb), textColor: imgPalette.lightVibrantBodyText });
        if (platformModule.device.sdkVersion >= "21") {
            try {
                var window_1 = app.android.foregroundActivity.getWindow();
                window_1.setStatusBarColor(new color.Color(imgPalette.vibrantRgb).android);
            }
            catch (ex) {
                //if the window isn't available then try agian after 50ms. fixes color not set on initial load.
                //todo finda better way to do this.
                setTimeout(function () {
                    var window = app.android.foregroundActivity.getWindow();
                    window.setStatusBarColor(new color.Color(imgPalette.vibrantRgb).android);
                }, 50);
                console.log(ex);
            }
        }
    }
}
exports.picLoaded = picLoaded;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi1wYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi1wYWdlLnRzIl0sIm5hbWVzIjpbInBhZ2VMb2FkZWQiLCJ0YXBFdmVudCIsInBpY0xvYWRlZCJdLCJtYXBwaW5ncyI6IkFBQUEsb0NBQW9DO0FBQ3BDLElBQU8sR0FBRyxXQUFXLGFBQWEsQ0FBQyxDQUFDO0FBSXBDLElBQVksT0FBTyxXQUFNLHFCQUFxQixDQUFDLENBQUE7QUFDL0MsSUFBWSxjQUFjLFdBQU8sVUFBVSxDQUFDLENBQUE7QUFDNUMsSUFBWSxLQUFLLFdBQU0sT0FBTyxDQUFDLENBQUE7QUFDL0IsSUFBWSxVQUFVLFdBQU0saUJBQWlCLENBQUMsQ0FBQTtBQUM5QyxJQUFZLFlBQVksV0FBTSx5QkFBeUIsQ0FBQyxDQUFBO0FBQ3hELElBQVksSUFBSSxXQUFNLGNBQWMsQ0FBQyxDQUFBO0FBQ3JDLElBQVksV0FBVyxXQUFNLGNBQWMsQ0FBQyxDQUFBO0FBRTVDLElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7QUFDeEIsSUFBSSxTQUFTLEdBQUcsSUFBSSxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQzlDLElBQUksT0FBTyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDO0FBQ2xDLElBQUksV0FBVyxDQUFDO0FBQ2hCLElBQUksUUFBUSxDQUFDO0FBQ2IsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDO0FBRW5CLG9CQUEyQixJQUFJO0lBQzlCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNiQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUN2QkEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFZEEsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsU0FBU0EsQ0FBQ0E7UUFFaENBLElBQUlBLElBQUlBLEdBQUdBLGFBQWFBLENBQUNBO1FB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